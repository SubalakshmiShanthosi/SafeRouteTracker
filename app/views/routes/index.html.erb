<label for="from">From</label>
<%= collection_select(:location, 0, Location.all, :name, :name) %>
<label for="to">To</label>
<%= collection_select(:location, 1, Location.all, :name, :name) %>
<div id="map" style="width:800px; height:800px"></div>
<script src="https://maps.googleapis.com/maps/api/js?v=3.exp&key=AIzaSyAoxCtn64wOaq5cGB5qcgGZnP_YhSKosJQ"></script>
<script>
    document.addEventListener("DOMContentLoaded", function(event) {
        var map;
        var directionsService = new google.maps.DirectionsService();
        var directionsDisplay = new google.maps.DirectionsRenderer({
            polylineOptions: {
                strokeColor: "black"
            }
        });
        function initialize() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 11,
                center: {lat: 13.0011774, lng: 80.2564957}
            });
            directionsDisplay.setMap(map);
            var points = [];
            from = !!document.getElementById('location_0').value ? document.getElementById('location_0').value : 'thiruvanmiyur';
            to = !!document.getElementById('location_1').value ? document.getElementById('location_1').value : 'tambaram';
            $.get('/routes/safe_path?from=' + from.replace(' ', '%20') + '&to=' + to.replace(' ', '%20'), function (data) {

                var path = new google.maps.Polyline({
                    path: data,
                    geodesic: true,
                    strokeColor: '#FF0000',
                    strokeOpacity: 1.0,
                    strokeWeight: 2
                });

                path.setMap(map);
            });
        }
        var fromOption = document.getElementById("location_0");
        fromOption.addEventListener("change", initialize, false);
        var toOption = document.getElementById("location_1");
        toOption.addEventListener("change", initialize, false);
        google.maps.event.addDomListener(window, 'load', initialize);

    });
</script>
